<!DOCTYPE html>
<html>
<head>
  <title>Extracted Links</title>
  <style>
    table {
      width: 100vw;
      border-collapse: collapse;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 8px;
      width: 200px;
      text-overflow: ellipsis;
      word-break: break-all;
    }
    th {
      background-color: #f4f4f4;
    }
    #searchBox {
      margin-bottom: 10px;
      padding: 8px;
      width: 98%;
      font-size: 16px;
    }
  </style>
</head>
<body>
  <h1>Extracted Links</h1>
  <input type="text" id="searchBox" onkeyup="filterTable()" placeholder="Search for links...">
  <table id="linksTable">
    <thead>
      <tr>
        <th>Link</th>
        <th>Source Post</th>
        <th>Date</th>
      </tr>
    </thead>
    <tbody>
      {% assign excluded_urls = "https://twitter.com/tomcritchlow/,https://www.linkedin.com/in/tomcritchlow/,https://www.are.na/tom-critchlow/index,https://calendly.com/tomcritchlow," | split: ',' %}
      {% assign all_links = "" | split: "" %}

      {% for post in site.posts %}
        {% assign content = post.output %}
        {% assign links = content | split:'href="' %}
        {% for segment in links offset:1 %}
          {% assign link = segment | split:'"' | first %}
          {% if link contains '://' %}
          {% unless link contains 'tomcritchlow.com' or excluded_urls contains link or all_links contains link %}
            {% assign all_links = all_links | push: link %}
            <tr>
              <td><a href="{{ link }}">{{ link }}</a></td>
              <td><a href="{{ post.url }}">{{ post.title }}</a></td>
              <td>{{ post.date | date: "%Y-%m-%d" }}</td>
            </tr>
          {% endunless %}
          {% endif %}
        {% endfor %}
      {% endfor %}

      {% for post in site.library %}
        {% assign content = post.output %}
        {% assign links = content | split:'href="' %}
        {% for segment in links offset:1 %}
          {% assign link = segment | split:'"' | first %}
          {% if link contains '://' %}
          {% unless link contains 'tomcritchlow.com' or excluded_urls contains link or all_links contains link %}
            {% assign all_links = all_links | push: link %}
            <tr>
              <td><a href="{{ link }}">{{ link }}</a></td>
              <td><a href="{{ post.url }}">{{ post.title }}</a></td>
              <td>{{ post.date | date: "%Y-%m-%d" }}</td>
            </tr>
          {% endunless %}
          {% endif %}
        {% endfor %}
      {% endfor %}
    </tbody>
  </table>

  <script>
    function filterTable() {
      const input = document.getElementById('searchBox');
      const filter = input.value.toLowerCase();
      const table = document.getElementById('linksTable');
      const rows = table.getElementsByTagName('tr');

      for (let i = 1; i < rows.length; i++) {
        const cells = rows[i].getElementsByTagName('td');
        let rowContainsFilter = false;

        for (let j = 0; j < cells.length; j++) {
          if (cells[j] && cells[j].innerText.toLowerCase().includes(filter)) {
            rowContainsFilter = true;
            break;
          }
        }

        rows[i].style.display = rowContainsFilter ? '' : 'none';
      }
    }
  </script>
</body>
</html>
